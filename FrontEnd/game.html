<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cyber Game</title>
</head>
<body>
  <div class="game-container">
    <h1>Welcome, {{ username }}!</h1>
    <div class="status-box">
      <h2>Caldera Attack Status</h2>
      <p>Operation ID (raw): {{ operation_id }}</p>
      <div id="attack-status">Loading...</div>
    </div>
  </div>
  <script>
  const operationId = "{{ operation_id }}";
  console.log("Injected operationId:", operationId);

  async function fetchStatus() {
    try {
      const response = await fetch(`/attack/status/${operationId}`);
      if (!response.ok) throw new Error(`HTTP ${response.status}`);

      const status = await response.json();
      console.log("Fetched status:", status);

      document.getElementById("attack-status").innerHTML = `
        <p><strong>Operation ID:</strong> ${status.id || "N/A"}</p>
        <p><strong>Name:</strong> ${status.name || "N/A"}</p>
        <p><strong>State:</strong> ${status.state || "N/A"}</p>
        <p><strong>Start Time:</strong> ${status.start || "N/A"}</p>
        <p><strong>Host Count:</strong> ${status.host_group ? status.host_group.length : "N/A"}</p>
      `;
    } catch (err) {
      console.error("fetchStatus error:", err);
      document.getElementById("attack-status").innerHTML =
        "<p style='color:red;'>Error fetching attack status.</p>";
    }
  }

  fetchStatus();
  setInterval(fetchStatus, 10000);
</script>

</body>
<p>Operation ID from Jinja: {{ operation_id }}</p>

</html>
